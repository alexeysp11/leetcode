# ThreadPool

Пул потоков - это механизм, который позволяет переиспользовать потоки в приложении. Вместо создания новых потоков для каждой задачи, пул потоков использует уже существующие потоки для выполнения задач.

В C# пул потоков реализуется с помощью класса `System.Threading.ThreadPool`. Он предоставляет методы для добавления задач в очередь пула потоков и автоматического распределения задач между доступными потоками.

В C# классы `Task` и `QueueUserWorkItemCallback`, с которым работает пул потоков, реализуют один и тот же интерфейс `IThreadPoolWorkItem`. 

В момент, когда вызывается метод `ThreadPool.QueueUserWorkItem()`, ссылка на метод, который предполагается выполнить, оборачивается в объект класса `QueueUserWorkItemCallback`, который реализует интерфейс `IThreadPoolWorkItem`, и этот новый объект отправляется в очередь пула потоков (важно помнить, что метод, который мы хотим выполнить, должен соответствать делегату `WaitCallback`, т.е. возвращать void и принимать объект).
Очередь пула потоков реализуется с помощью класса `ThreadPoolWorkQueue`.
Метод выполнится, когда поток пула потоков будет свободен.
С помощью метода GetAvailableThreads можно получить количество свободных потоков (потоков воркеров и ввода-вывода).

В приложениях, которые работают на платформе Windows, по умолчанию вместо .NET `ThreadPool` используется Windows `ThreadPool`.
В документации сказано, что API метод для выставления максимального или минимального количества потоков для пула потоков находится в библиотеке `Kernel32.dll`.
Подробнее об этом можно почитать по ссылкам [Runtime configuration options for threading](https://learn.microsoft.com/en-us/dotnet/core/runtime-config/threading) и [Thread pool API](https://learn.microsoft.com/en-us/windows/win32/procthread/thread-pool-api).

Для лучшего понимания работы пула потоков в C# можно выполнить практические задачи, например, создать несколько задач, которые будут выполняться параллельно в пуле потоков, и измерить время выполнения.
