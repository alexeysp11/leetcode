# Triggers

Задачи, направленные на закрепление практических навыков работы с триггерами.

Конфигурация таблиц для закрепления практических навыков работы с PostgreSQL представлена в файле [Config.FinancialTransactions_Products.sql](../../../sql/postgresql/Config.FinancialTransactions_Products.sql). 
Аналогичную конфигурацию и определение таблиц можно использовать для других реляционных баз данных. 

## Использование в БД для enterprise приложений

Триггеры - это специальные функции, которые вызываются автоматически при определенных событиях в базе данных, таких как вставка, обновление или удаление строк в таблице. Их можно использовать для реализации бизнес-правил, проверки целостности данных, аудита и многих других задач.

Также триггеры можно использовать для заполнения таблиц, хранящих историю изменений в конкретной таблице. Например, при каждом обновлении строки в таблице "Orders" можно создать запись в таблице "OrdersHistory", содержащую информацию о предыдущем значении этой строки. Это позволяет отслеживать историю изменений и восстанавливать данные в случае ошибочного обновления.

Триггеры в БД используются для автоматического выполнения определенных действий при изменении данных в таблице. 
Они позволяют управлять целостностью данных, контролировать доступ к данным и обеспечивать безопасность. 
Также триггеры могут использоваться для создания аудита изменений данных, для автоматической генерации отчетов и уведомлений.

## Задачи

### Общие задачи 

Задачи для улучшения навыков использования триггеров в PostgreSQL:

- Создать триггер для автоматического заполнения поля "created_at" при создании новой записи в таблице.
- Создать триггер для проверки уникальности значения поля при вставке или обновлении записей.
- Создать триггер для автоматического обновления суммы заказа при изменении количества товаров в заказе.
- Создать триггер для проверки корректности формата электронной почты при вставке или обновлении записей.
- Создать триггер для автоматического вычисления среднего значения поля "rating" при добавлении новой оценки.
- Создать триггер для автоматического заполнения поля "updated_at" при обновлении записи в таблице.
- Создать триггер для проверки прав доступа при вставке, обновлении или удалении записей.
- Создать триггер для автоматического вычисления суммы заказов пользователя за последний месяц.
- Создать триггер для автоматического обновления статуса заказа на "выполнен" при достижении определенного количества товаров на складе.
- Создать триггер для автоматического создания записи в таблице "OrdersHistory" при обновлении записи в таблице "Orders".

## FinancialTransactions_Products

### SQL 

Таблицы в БД определены следующим образом:

```SQL
CREATE TABLE FinancialTransactions_Users (
    UserId SERIAL PRIMARY KEY,
    FirstName VARCHAR(50),
    LastName VARCHAR(50),
    Email VARCHAR(50) UNIQUE,
    Password VARCHAR(50),
    ChangeDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE FinancialTransactions_Addresses (
    AddressId SERIAL PRIMARY KEY,
    UserId INT REFERENCES FinancialTransactions_Users(UserId),
    Street VARCHAR(50),
    City VARCHAR(50),
    State VARCHAR(50),
    ZipCode VARCHAR(10),
    ChangeDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Задачи

10 задач для улучшения навыков работы с триггерами:

1. Создание триггера, который будет автоматически обновлять дату последнего изменения записи при любом изменении данных в таблице.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать при любом изменении данных в таблице и обновлять поле ChangeDate на текущую дату и время.

2. Написание триггера, который будет запрещать удаление записей из таблицы, если они используются в других таблицах.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать перед удалением записи и проверять, используется ли данная запись в других таблицах. Если да, то удаление записи должно быть отменено.

3. Разработка триггера, который будет автоматически создавать резервную копию таблицы при каждом изменении данных.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать после каждого изменения данных и создавать резервную копию таблицы в отдельной таблице Backup с указанием времени изменения.

4. Создание триггера, который будет автоматически обновлять статистику по таблице при ее изменении.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать после каждого изменения данных и обновлять статистику по таблице в отдельной таблице Stats.

5. Написание триггера, который будет автоматически генерировать уведомление о новых записях в таблице.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать после каждого добавления новой записи и генерировать уведомление о новой записи в отдельную таблицу Notifications.

6. Разработка триггера, который будет автоматически изменять данные в другой таблице при изменении данных в текущей таблице.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать после каждого изменения данных и обновлять соответствующие данные в другой таблице, например, при изменении адреса в таблице FinancialTransactions_Addresses, данные об этом адресе также должны быть изменены в таблице FinancialTransactions_Orders.

7. Создание триггера, который будет автоматически генерировать уникальные идентификаторы для новых записей в таблице.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать перед добавлением новой записи и генерировать уникальный идентификатор для этой записи.

8. Написание триггера, который будет автоматически проверять корректность вводимых данных и выводить сообщение об ошибке при необходимости.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать перед добавлением или изменением данных и проверять корректность вводимых данных. Если данные некорректны, то триггер должен вывести сообщение об ошибке.

9. Разработка триггера, который будет автоматически обновлять связанные данные в других таблицах при изменении данных в текущей таблице.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать после каждого изменения данных и обновлять связанные данные в других таблицах, например, при изменении адреса в таблице FinancialTransactions_Addresses, данные об этом адресе также должны быть изменены в таблице FinancialTransactions_Orders.

10. Создание триггера, который будет автоматически запускать процедуру обработки данных при изменении данных в таблице.

Данный триггер должен быть написан на таблице FinancialTransactions_Users и FinancialTransactions_Addresses. 
Он должен срабатывать после каждого изменения данных и запускать процедуру обработки данных, например, при изменении адреса в таблице FinancialTransactions_Addresses, процедура обработки может отправлять уведомление о новом адресе всем пользователям, которые используют этот адрес.
